# About OS

---

## 启动

### 镜像布局

|  区块    |  长度   |  内容               |
|  :--:   |  :--:   | :--:               |
| MBR     |  512B   | 引导代码 + 分区表    |
| 引导扇区 | 10KB    | 加载器代码           |
| 保留扇区 |  约20KB  | 空                 |
| FAT12   |   剩余   | 文件系统            |

### FAT12文件系统

...

### 引导（boot）

+ CPU上电后，从硬盘第0磁头第0磁道第1扇区读取**MBR数据块**（512字节）的代码，并开始执行。

+ 这段代码的起始内存地址是`0x7C00`，可执行部分占据不超过446字节。

+ 作用：将段寄存器清零，设置栈指针为`0x7C00`（也就是设置栈空间为0~0x7C00），检查BIOS是否支持扩展读取服务，这段代码将它后面10KB的代码加载到内存`0x7E00`地址处，并跳转到该位置执行。

### 加载（loader）

+ 根据 [难道真的没有使用C语言编写16位实模式bin文件的方法吗？](https://www.zhihu.com/question/531191396/answer/2469221166)，无法在16位实模式下使用C语言，为了简化代码，先进入保护模式再使用C语言读取文件系统

+ 作用：打开A20地址线，进入保护模式，读取FAT12文件系统将内核加载到内存，并将控制流交给内核入口点。